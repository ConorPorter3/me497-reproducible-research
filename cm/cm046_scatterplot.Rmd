---
output: github_document
--- 

# scatterplot  

```{r cm046-01, echo = FALSE}
library(knitr)
opts_knit$set(root.dir = "../")
opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, collapse = TRUE, fig.keep = 'high')
```

```{r cm046-02, echo = FALSE}
# functions for text_icon and code_icon
source("cm/helper_02_icons.R")
```

## getting started 

We're using the `olives` data set from the `extracat` package. The `olives` data are measurements of fatty acid content in Italian olive oils.  

- Install `extracat` in the usual fashion, *Packages > Install > extracat*. 
- Create `scatterplot.Rmd` in your `practiceR/scripts/` directory. Write the code chunks in the tutorial with as much of the prose as you like  to explain the work. 

Then we can load the packages we're planning to use. 

`r code_icon`
```{r cm046-03}
# packages we'll be using
library(extracat) 
library(ggplot2)
library(dplyr)
```

## data 

`r code_icon`
```{r cm046-04}
# load the data set
data(olives)

# examine the data 
glimpse(olives)
```

For our scatterplot explorations, we'll use the data for linoleic acid and oleic acid. 

- Linoleic acid is a polyunsaturated omega-6 fatty acid that makes up about 3.5-21% of olive oil. 
- Oleic acid is a monounsaturated omega-9 fatty acid that makes up 55-83% of olive oil. 


## graph

The first version of the graph is a straightforward scatterplot. 

`r code_icon`
```{r cm046-05}
# all the data in one panel 
p <- ggplot(data = olives, aes(x = oleic, y = linoleic)) + 
	geom_point()
p
```

There appears to be an inverse relationship between the two acids. Let's add a locally-weighted, low-order-polynomial regression, called a "loess" smooth fit. The gray envelope is a bound on uncertainty. 

`r code_icon`
```{r cm046-06}
# add a loess fitted curve 
p <- p + stat_smooth(method = "loess")
p
```

The loess curve is fairly linear except at the extremes, so if we do a curve fit, a linear fit is probably OK. 

`r code_icon`
```{r cm046-07}
# change to a linear regression 
p <- ggplot(data = olives, aes(x = oleic, y = linoleic)) + 
	geom_point() +
	stat_smooth(method = "lm")
p
```


## comparing subsets

The data set includes two geographic variables, **Area** and **Region**. 

`r code_icon`
```{r cm046-08}
# examine the Area variable 
summary(olives$Area)

# examine the Region variable
summary(olives$Region)
```

I'm going to condition the data by **Region**. First, I'll leave all the data in one panel, but use color to identify the three regions.

`r code_icon`
```{r cm046-09}
# identify regions by color 
p <- ggplot(data = olives, aes(x = oleic, y = linoleic, color = Region)) + 
	geom_point()
p
```

Next, I'm going to separate the regions into different panels using `facet_wrap()`. 

`r code_icon`
```{r cm046-10}
# produce one panel per region 
p <- ggplot(data = olives, aes(x = oleic, y = linoleic)) + 
	geom_point() + 
	facet_wrap(~Region)
p
```

With regions in separate panels, color coding is no longer needed. 



# edit for publication 

I'd like to edit the axis labels to include units, but they aren't given in the data set help page. I think the numbers are in mg of fatty acid per 10 g of oil. For example, the first entry in the oleic acid column is `r olives$oleic[1]`. If that number has units of mg oleic / 10 g oil, then: 

`r olives$oleic[1]` mg oleic / 10 g oil    
   = `r olives$oleic[1]/10`  mg oleic / g oil    
   = `r olives$oleic[1]/10/1000` g oleic / g oil, i.e., gram/gram    
   = `r olives$oleic[1]/10/1000*100`%    

This percentage is within the expected range of 55-83%. Thus a data value of `r olives$oleic[1]` actually represents `r olives$oleic[1]/100`%. Thus I will divide my columns by 100 to obtain fatty acid content as a percentage of the total mass of olive oil. 

`r code_icon`
```{r cm046-11}
# convert the data to a percentage of oil mass 
olives <- olives %>%
	mutate(oleic = oleic/100) %>%
	mutate(linoleic = linoleic/100)
```

New graph with the scales in percent; edit the axis labels.  

`r code_icon`
```{r cm046-12}
p <- ggplot(data = olives, aes(x = oleic, y = linoleic)) + 
	geom_point() + 
	facet_wrap(~Region) + 
	labs(x = "Oleic acid (%)", y = "Linoleic acid (%)")
p
```

With both scales in percent, I would like a 1:1 aspect ratio so that a 5% change on one axis is the same length on the other axis. 

`r code_icon`
```{r cm046-13}
p <- p + coord_fixed(ratio = 1)
p
```

That's sort of squished, so let's put the panels in a column instead of a row. 

`r code_icon`
```{r cm046-14}
p <- p + facet_wrap(~Region, ncol = 1)
p
```

Lastly, I can add a regression to each panel. 

`r code_icon`
```{r cm046-15}
p <- p + stat_smooth(data = olives, method = "lm")
p
```

As always,the graph could have been be drawn in one code chunk, e.g., 

```{r  cm046-16, eval = FALSE}
ggplot(data = olives, aes(x = oleic, y = linoleic)) + 
	geom_point() + 
	facet_wrap(~Region, ncol = 1) + 
	labs(x = "Oleic acid (%)", y = "Linoleic acid (%)") + 
	coord_fixed(ratio = 1) + 
	stat_smooth(data = olives, method = "lm")
```

Some publications are printed in two-column format. To keep the total page count down (some publications charge authors for extra pages), you can arrange your panels in a single column like this one and place them in a single column of the two-column format. 

Of course, if you publish electronically, e.g., writing your own blog, there is no page count nor any page breaks, so you can orient your figures for onscreen viewing. 

--- 
[main page](../README.md)
